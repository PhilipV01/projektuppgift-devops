name: CI with wdio tests

on: 
  push:
    branches: [Allerue-setup]

jobs: 
  build:
    runs-on: ubuntu-latest
    steps: 
    #fetching current ref
     - uses: actions/checkout@v2 
     #install a chromium
     - name: Set up chromedriver 
       uses: nanasess/setup-chromedriver@1
     - run: |
          export DISPLAY=:99
          chromedriver --url-base=/wd/hub &
          sudo apt-get install vfb -ac :99 -screen 0 1280x1024x24 > /dev/null 2>&1 & # optional  
    
     #Node 
     - name: Use Node.js ${{ matrix.node-version }}
       uses: actions/setup-node@v2
       with: 
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
     #- run: npm ci
     #- run: npm run bild --if-present
     - name: Install dependencies  
       run: npm install
       
     # Run wdio test
     - name: Run wdio test
       run: BROWSERSTACK_USERNAME=${{secrets.BROWSERSTACK_USERNAME}} BROWSERSTACK_ACCESS_KEY=${{secrets.BROWSERSTACK_ACCESS_KEY}} npm run wdio 
       uses: actions/upload-artigact@v1
       if: failure()
       with: 
          name: logs
          path: logs
       
